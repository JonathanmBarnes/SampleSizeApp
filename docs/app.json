[{"name":"app.R","content":"# app.R\n\nlibrary(shiny)\nlibrary(bslib)\nlibrary(ggplot2)\nlibrary(pwr)\n\n'\nunlink(\"docs\", recursive = TRUE, force = TRUE)\nshinylive::export(appdir = \".\", destdir = \"docs\")\nhttpuv::runStaticServer(\"docs\", port = 8000)\n'\n\n\nif (FALSE) {\n  library(munsell)\n  library(tibble)\n  #library(tidyverse)\n}\n\n\nPlot_theme <- function(\n    base_font    = c(\"Avenir Next\", \"Verdana\", \"sans-serif\"),\n    heading_font = c(\"Trebuchet MS\", \"Avenir\", \"Verdana\", \"sans-serif\"),\n    base_size = 14,\n    transparent = FALSE,\n    show_minor_grid = TRUE\n) {\n  base_family    <- base_font[[1]]\n  heading_family <- heading_font[[1]]\n  bg <- if (transparent) \"transparent\" else \"#f7f6f3\"\n\n  theme_minimal(base_size = base_size, base_family = base_family) %+replace% theme(\n    # Backgrounds\n    plot.background  = element_rect(fill = bg, color = NA),\n    panel.background = element_rect(fill = bg, color = NA),\n\n    # Text color baseline\n    text = element_text(color = \"#343A40\"),\n\n    # Grid lines (cool blue)\n    panel.grid.major = element_line(color = \"#cfdceb\", linewidth = 0.45),\n    panel.grid.minor = if (isTRUE(show_minor_grid)) {\n      element_line(color = \"#e3edf7\", linewidth = 0.25)\n    } else {\n      element_blank()\n    },\n\n    # Axes\n    axis.line = element_line(color = \"#9fb3c1\"),\n\n    axis.text.x = element_text(color = \"#343A40\", family = base_family, size = 15, angle = 0),\n    axis.text.y = element_text(color = \"#343A40\", family = base_family, size = 15, angle = 0),\n\n    axis.title.x = element_text(color = \"#343A40\", family = heading_family, face = \"bold\", size = 15, angle = 0),\n    axis.title.y = element_text(color = \"#343A40\", family = heading_family, face = \"bold\", size = 15, angle = 90),\n\n    # Titles\n    plot.title = element_text(\n      family = heading_family, size = 18, face = \"bold\",\n      color = \"#2f3e46\",\n      margin = margin(b = 10, unit = \"pt\")\n    ),\n    plot.subtitle = element_text(family = base_family, size = 14, color = \"#3b4a55\"),\n\n    # Legend\n    legend.title = element_text(family = heading_family, face = \"bold\", color = \"#2f3e46\"),\n    legend.text  = element_text(family = base_family, color = \"#3b4a55\"),\n\n    # Spacing\n    plot.margin = margin(t = 10, r = 20, b = 5, l = 10, unit = \"pt\")\n  )\n}\n\n\nsource(\"SSandP.R\")\n\nui <- page_navbar(\n  title = \"Sample Size & Power Visualizer\",\n  theme = bs_theme(version = 5,\n                   bg            = \"#f7f6f3\",   # page background\n                   fg            = \"#343A40\",   # default text/link color\n                   primary       = \"#2f6f8f\",   # .btn-primary, active tabs\n                   secondary     = \"#495057\",   # navbar background\n                   info          = \"#2f6f8f\",   # accents for h6, info alerts, etc.\n                   code_bg       = \"#f7f6f3\",   # <code> & <pre> background\n                   code_fg       = \"#3182ce\",   # <code> & <pre> text\n                   base_font     = c(\"Avenir Next\", \"Verdana\", \"sans-serif\"),\n                   heading_font  = c(\"Trebuchet MS\", \"Avenir\", \"Verdana\", \"sans-serif\"),\n                   link_color_hover = \"#137288\",\n                   link_visited     = \"#137288\",),\n\n\n  tags$head(\n    tags$link(rel = \"stylesheet\", href = \"styles.css\")\n  ),\n\n  # These two make the app use the viewport more naturally\n  fillable = TRUE,\n\n  # Optional: remove the “container” max-width so it spans the page nicely\n  # (If you prefer constrained width, delete this line.)\n  fluid = TRUE,\n\n  # --- Left sidebar shared across all tabs ---\n  sidebar = sidebar(\n    width = 450,\n    h5(\"Conceptual knobs\"),\n    selectInput(\n      \"mock_test\",\n      \"Scenario\",\n      choices = c(\n        \"Two-group mean difference (t-test)\" = \"two_t\",\n        \"Two-group mean difference (paired t-test)\" = \"paired_t\",\n        \"One-way ANOVA (k groups)\" = \"anova1\",\n        \"Chi-square (df)\" = \"chisq\"\n      ),\n      selected = \"two_t\"\n    ),\n    conditionalPanel(\n      condition = \"input.mock_test === 'anova1'\",\n\n      tagList(\n        p(strong(\"What it is\")),\n        p(\"In ANOVA, K is the number of groups being compared. Each group represents a distinct category or condition whose average outcome is being tested against the others.\"),\n\n        p(strong(\"Why it matters\")),\n        p(\"As the number of groups increases, the test becomes more complex. With more groups, it is harder to detect differences unless the effects are large or the sample size is sufficiently high.\")\n      ),\n\n      sliderInput(\"k_groups\", \"Number of groups (k)\", min = 2, max = 10, value = 3, step = 1, width = \"100%\")\n    ),\n    conditionalPanel(\n      condition = \"input.mock_test === 'chisq'\",\n\n      tagList(\n        p(strong(\"What it is\")),\n        p(\"Degrees of freedom describe how many independent categories or comparisons are involved in the chi-squared test. More categories mean more ways the data can vary.\"),\n\n        p(strong(\"Why it matters\")),\n        p(\"As degrees of freedom increase, the chi-squared distribution changes. This affects how unusual a result must be before it is considered statistically significant, even if the total sample size stays the same.\")\n      ),\n\n      sliderInput(\"df_chi\", \"Degrees of freedom (df)\", min = 1, max = 20, value = 1, step = 1, width = \"100%\")\n    ),\n\n    tagList(\n      p(strong(\"What it is\")),\n      p(\"The significance level (α) is the threshold for how much evidence is required before calling a result statistically significant. It controls how willing you are to risk a false alarm.\"),\n\n      p(strong(\"Why it matters\")),\n      p(\"Lower α makes it harder to claim an effect (fewer false positives but more missed effects). Higher α makes it easier to detect effects but increases the chance of finding patterns that are actually due to random noise.\")\n    ),\n\n    sliderInput(\"alpha\", \"Significance level (α)\", min = 0.001, max = 0.2, value = 0.05, step = 0.05, width = \"100%\")\n  ),\n\n  # --- Top navbar tabs (these replace your old accordion “boxes”) ---\n  nav_panel(\"Effect Size\", SSP_tab_effect_size()),\n  nav_panel(\"Sample Size\", SSP_tab_sample_size()),\n  nav_panel(\"Power\", SSP_tab_power()),\n  nav_panel(\"Trade-offs\", SSP_tab_tradeoffs()),\n  nav_panel(\n    \"Acknowledgments\",\n    card(\n      card_body(\n        p(strong(\"Funding and Disclaimer\")),\n        p(\"This project is supported by the Assistant Secretary for Technology Policy (ASTP) of the US Department of Health and Human Services (HHS) under grant number 90PH0005/01-13.\"),\n        p(\"This information or content and conclusions are those of the authors and should not be construed as the official position or policy of, nor should any endorsements be inferred by ASTP, HHS or the U.S. Government.\")\n      )\n    )\n  )\n\n)\n\nserver <- function(input, output, session) {\n\n  effect_grid <- reactive({\n    tt <- input$mock_test\n    if (tt %in% c(\"two_t\", \"paired_t\")) return(seq(0.05, 1, length.out = 200))  # d\n    if (tt == \"anova1\")                return(seq(0.05, 1, length.out = 200)) # f\n    if (tt == \"chisq\")                 return(seq(0.05, 1, length.out = 200)) # w\n    seq(0.05, 1, length.out = 200)\n  })\n\n  effect_label <- reactive({\n    tt <- input$mock_test\n    if (tt %in% c(\"two_t\", \"paired_t\")) \"Effect size (Cohen's d)\"\n    if (tt == \"anova1\")                \"Effect size (Cohen's f)\"\n    if (tt == \"chisq\")                 \"Effect size (Cohen's w)\"\n    \"Effect size\"\n  })\n\n  output$var_selectorSSP <- renderUI({\n    tagList(\n      selectInput(\n        \"calc_powerSSP\",\n        \"What do you want to solve for?\",\n        choices = c(\"Power (given n)\" = \"power\", \"Required n (given power)\" = \"n\"),\n        selected = \"power\"\n      ),\n      sliderInput(\n        \"effect_sizeSSP\", effect_label(),\n        min = min(effect_grid()), max = max(effect_grid()),\n        value = median(effect_grid()),\n        step = (max(effect_grid()) - min(effect_grid())) / 200,\n        width = \"100%\"\n      ),\n      conditionalPanel(\n        condition = \"input.calc_powerSSP === 'power'\",\n        sliderInput(\n          \"sample_sizeSSP\", \"Sample size (per group)\",\n          min = 10, max = 250, value = 50, step = 5, width = \"100%\"\n        )\n      ),\n      conditionalPanel(\n        condition = \"input.calc_powerSSP === 'n'\",\n        sliderInput(\n          \"target_powerSSP\", \"Target power\",\n          min = 0.50, max = 0.99, value = 0.80, step = 0.05, width = \"100%\"\n        )\n      )\n    )\n  })\n\n  output$groupsSSP <- renderUI({\n    if (input$mock_test == \"anova1\") {\n      sliderInput(\"groupsSSP\", \"# groups (k)\", min = 2, max = 10, value = input$k_groups, step = 1, width = \"100%\")\n    } else NULL\n  })\n\n  output$df_chiSSP <- renderUI({\n    if (input$mock_test == \"chisq\") {\n      sliderInput(\"df_chiSSP\", \"Chi-square df\", min = 1, max = 20, value = input$df_chi, step = 1, width = \"100%\")\n    } else NULL\n  })\n\n\n\n\n\n\n  output$demo_effPowerPlotSSP <- renderPlot({\n    tt <- input$mock_test\n    n_fixed <- input$demo_nSSP\n    req(n_fixed)\n\n    es <- effect_grid()\n    pw <- vapply(es, function(e) {\n      solve_power(\n        test_type = tt,\n        effect    = e,\n        n         = n_fixed,\n        alpha     = input$alpha,\n        k         = if (tt == \"anova1\") input$k_groups else NULL,\n        df_chi    = if (tt == \"chisq\")  input$df_chi  else NULL\n      )$power\n    }, numeric(1))\n\n    df <- data.frame(effect = es, power = pw)\n    idx80 <- which.min(abs(df$power - 0.80))\n    idx90 <- which.min(abs(df$power - 0.90))\n    pts <- df[c(idx80, idx90), ]\n\n    ggplot(df, aes(effect, power)) +\n      geom_line(alpha = 0.75, linewidth = 0.9, colour = \"#2f3e46\") +\n      geom_point(data = pts, aes(effect, power), colour = \"#E69F00\", size = 3) +\n      geom_text(\n        data = pts,\n        aes(effect, power, label = sprintf(\"%.2f\", power)),\n        vjust = 1.3, hjust = -0.6,\n        family = \"Avenir Next\", size = 5, colour = \"#343A40\"\n      ) +\n      labs(\n        x = effect_label(), y = \"Power\",\n        title = sprintf(\"Power vs Effect Size (n = %d, α = %.3f)\", n_fixed, input$alpha)\n      ) +\n      scale_y_continuous(limits = c(0, 1), expand = c(0.001, 0.001)) +\n      Plot_theme()\n  })\n\n\n\n\n\n  output$demo_ssPowerPlotSSP <- renderPlot({\n    tt <- input$mock_test\n    eff_fixed <- max(input$demo_effSSP, 0.01)  # guard against 0\n    req(eff_fixed)\n\n    ns <- 5:1000\n    pw <- vapply(ns, function(n) {\n      solve_power(\n        test_type = tt,\n        effect    = eff_fixed,\n        n         = n,\n        alpha     = input$alpha,\n        k         = if (tt == \"anova1\") input$k_groups else NULL,\n        df_chi    = if (tt == \"chisq\")  input$df_chi  else NULL\n      )$power\n    }, numeric(1))\n\n    df <- data.frame(n = ns, power = pw)\n    idx80 <- which.min(abs(df$power - 0.80))\n    idx90 <- which.min(abs(df$power - 0.90))\n    pts <- df[c(idx80, idx90), ]\n    pts$label <- sprintf(\"n= %d, p= %.2f\", pts$n, pts$power)\n\n    ggplot(df, aes(n, power)) +\n      geom_line() +\n      geom_point(data = pts, aes(n, power), colour = \"#E69F00\", size = 3) +\n      geom_text(data = pts, aes(n, power, label = label),\n                vjust = 1.25, hjust = -0.3, family = \"Avenir Next\", size = 5, colour = \"#343A40\") +\n      labs(x = \"Sample size (per group)\", y = \"Power\",\n           title = sprintf(\"Power vs Sample Size (%s, α = %.3f)\", effect_label(), input$alpha)) +\n      scale_x_continuous(limits = c(5, 1000), expand = c(0.001, 0.001)) +\n      scale_y_continuous(limits = c(0, 1), expand = c(0.001, 0.001)) + Plot_theme()\n  })\n\n\n\n\n\n  output$demo_effSSPlotSSP <- renderPlot({\n    tt <- input$mock_test\n    pow_fixed <- input$demo_powerSSP\n    req(pow_fixed)\n\n    es <- effect_grid()\n    ns <- vapply(es, function(e) {\n      solve_power(\n        test_type = tt,\n        effect    = e,\n        power     = pow_fixed,\n        alpha     = input$alpha,\n        k         = if (tt == \"anova1\") input$k_groups else NULL,\n        df_chi    = if (tt == \"chisq\")  input$df_chi  else NULL\n      )$n\n    }, numeric(1))\n\n    df <- data.frame(effect = es, n = ns)\n\n    targets <- quantile(es, probs = c(0.2, 0.5, 0.8))\n    idxs <- vapply(targets, function(t) which.min(abs(df$effect - t)), integer(1))\n    pts <- df[idxs, ]\n\n    ggplot(df, aes(effect, n)) +\n      geom_line(alpha = 0.75, linewidth = 0.9, colour = \"#2f3e46\") +\n      geom_point(data = pts, aes(effect, n), colour = \"#E69F00\", size = 3) +\n      geom_text(\n        data = pts,\n        aes(effect, n, label = round(n)),\n        vjust = -1.25, hjust = -0.6,\n        family = \"Avenir Next\", size = 5, colour = \"#343A40\"\n      ) +\n      labs(\n        x = effect_label(), y = \"Required sample size (per group)\",\n        title = sprintf(\"Required n vs Effect Size (power = %.2f, α = %.3f)\", pow_fixed, input$alpha)\n      ) +\n      scale_y_continuous(limits = c(0, 1000), expand = c(0.001, 0.001)) +\n      Plot_theme()\n  })\n\n\n\n\n\n  output$ss_power_plotSSP <- renderPlot({\n    tt <- input$mock_test\n    req(input$effect_sizeSSP)\n\n    if (input$calc_powerSSP == \"power\") {\n      req(input$sample_sizeSSP)\n      res <- solve_power(\n        test_type = tt,\n        effect    = input$effect_sizeSSP,\n        n         = input$sample_sizeSSP,\n        alpha     = input$alpha,\n        k         = if (tt == \"anova1\") input$k_groups else NULL,\n        df_chi    = if (tt == \"chisq\")  input$df_chi  else NULL\n      )\n    } else {\n      req(input$target_powerSSP)\n      res <- solve_power(\n        test_type = tt,\n        effect    = input$effect_sizeSSP,\n        power     = input$target_powerSSP,\n        alpha     = input$alpha,\n        k         = if (tt == \"anova1\") input$k_groups else NULL,\n        df_chi    = if (tt == \"chisq\")  input$df_chi  else NULL\n      )\n    }\n\n    axis_max <- 1000\n    ns <- 5:axis_max\n    pw <- vapply(ns, function(n) {\n      solve_power(\n        test_type = tt,\n        effect    = input$effect_sizeSSP,\n        n         = n,\n        alpha     = input$alpha,\n        k         = if (tt == \"anova1\") input$k_groups else NULL,\n        df_chi    = if (tt == \"chisq\")  input$df_chi  else NULL\n      )$power\n    }, numeric(1))\n\n    df <- data.frame(n = ns, power = pw)\n\n    g <- ggplot(df, aes(n, power)) +\n      geom_line() +\n      labs(x = \"Sample size (per group)\", y = \"Power\", title = \"Power curve\") +\n      scale_y_continuous(limits = c(0, 1), expand = c(0.001, 0.001)) +\n      scale_x_continuous(limits = c(5, axis_max), expand = c(0.001, 0.001)) + Plot_theme()\n\n    if (!is.null(res$n) && is.finite(res$n) && res$n <= axis_max) {\n      pt <- data.frame(n = res$n, power = res$power)\n      lbl <- paste0(\n        effect_label(), \": \", sprintf(\"%.3f\", input$effect_sizeSSP), \"\\n\",\n        \" α: \", sprintf(\"%.3f\", input$alpha), \"\\n\",\n        \"  n: \", res$n, \"\\n\",\n        \" Power: \", sprintf(\"%.2f\", res$power)\n      )\n\n      g +\n        geom_point(data = pt, aes(n, power), colour = \"#E69F00\", size = 4) +\n        geom_label(data = pt, aes(n, power, label = lbl),\n                   vjust = 1.2, hjust = -0.05,\n                   family = \"Avenir Next\", size = 5,\n                   colour = \"#343A40\", fill = \"#FCFDFF\",\n                   label.size = 0.2)\n    } else {\n      g +\n        annotate(\"label\", x = axis_max * 0.65, y = 0.25,\n                 label = paste0(\"Required n ≈ \", res$n, \" (off-plot)\\nTry a larger effect or lower target power.\"),\n                 family = \"Avenir Next\", size = 5,\n                 colour = \"#343A40\", fill = \"#FCFDFF\",\n                 label.size = 0.2)\n    }\n  })\n}\n\nshinyApp(ui, server)\n","type":"text"},{"name":"SSandP.R","content":"# ---- shared constant (optional) ----\nSSP_VH <- \"calc(100vh - 120px)\"  # adjust if navbar/header height differs\n\n\nSSP_tab_effect_size <- function() {\n  layout_columns(\n    col_widths = c(4, 8),\n\n    # Left: scrollable text + slider\n    card(\n      height = SSP_VH,\n      card_header(\"Effect Size\"),\n      card_body(\n        div(\n          style = paste0(\n            \"overflow-y:auto;\",\n            \"max-height:calc(100vh - 200px);\",\n            \"padding-right:8px;\"\n          ),\n\n          tagList(\n            p(strong(\"What it is\")),\n            p(\"Effect size describes how large a real difference or relationship actually is. It is about magnitude, not just whether a result is statistically significant.\"),\n            p(\"Because it is about size, effect size helps answer a practical question: even if something is real, is it big enough to matter in the real world?\"),\n\n            p(strong(\"Why it matters\")),\n            p(\"Large effects are easier to detect, even with small samples. Small effects can be real but difficult to observe unless a study has enough data.\"),\n            p(\"A helpful intuition is “signal strength”: bigger effects are a louder signal, and power analysis asks how much listening (data) you need to reliably hear it through noise.\"),\n\n            p(strong(\"What this visualization shows\")),\n            p(\"The curve shows how the probability of detecting an effect changes as the effect becomes larger, assuming a fixed sample size.\"),\n            p(\"As effect size increases, the curve rises because the signal becomes easier to distinguish from random variation.\"),\n\n            p(strong(\"Common pitfalls\")),\n            p(\"Effect size is often confused with statistical significance. A tiny effect can be statistically significant in a very large study, while a meaningful effect can fail to reach significance in a small study.\"),\n            p(\"When planning, people often assume effects will be larger than they really are, which can lead to studies that are underpowered for the true (smaller) effect.\")\n          ),\n\n          hr(),\n\n          sliderInput(\n            \"demo_nSSP\", \"Sample size (n):\",\n            min = 10, max = 300, value = 50, step = 10,\n            width = \"100%\", animate = TRUE\n          )\n        )\n      )\n    ),\n\n    # Right: plot fills\n    card(\n      height = SSP_VH,\n      full_screen = TRUE,\n      card_header(\"Effect Size → Power\"),\n      card_body_fill(\n        plotOutput(\"demo_effPowerPlotSSP\", height = \"100%\")\n      )\n    )\n  )\n}\n\n\nSSP_tab_sample_size <- function() {\n  layout_columns(\n    col_widths = c(4, 8),\n\n    card(\n      height = SSP_VH,\n      card_header(\"Sample Size\"),\n      card_body(\n        div(\n          style = paste0(\n            \"overflow-y:auto;\",\n            \"max-height:calc(100vh - 200px);\",\n            \"padding-right:8px;\"\n          ),\n\n          tagList(\n            p(strong(\"What it is\")),\n            p(\"Sample size is the number of observations or participants in a study. It determines how much information is available to detect real patterns rather than random noise.\"),\n            p(\"In general, larger samples also produce more precise estimates (narrower uncertainty), not just a higher chance of detecting an effect.\"),\n\n            p(strong(\"Why it matters\")),\n            p(\"With too little data, real effects are often missed and estimates become unstable. With more data, patterns become clearer and uncertainty decreases.\"),\n            p(\"But “more data” does not automatically mean “more useful insight”: if measurement is noisy or biased, adding more observations can simply give a very confident estimate of the wrong thing.\"),\n\n            p(strong(\"What this visualization shows\")),\n            p(\"The curve shows how the chance of detecting an effect changes as the sample size increases, for a fixed effect size.\"),\n            p(\"The curve typically increases quickly at first and then levels off, reflecting diminishing returns: early increases in sample size help a lot, later increases help less.\"),\n\n            p(strong(\"Common pitfalls\")),\n            p(\"There is no universally correct sample size. Choosing sample sizes based on convenience rather than analytical needs can lead to inconclusive or misleading results.\"),\n            p(\"Very large samples can make trivial effects appear statistically significant, so it is important to interpret results in terms of practical impact, not just p-values.\")\n          ),\n\n          hr(),\n\n          sliderInput(\n            \"demo_effSSP\", \"Effect size (d / r² / f / w):\",\n            min = 0.1, max = 1.5, value = 0.2, step = 0.1,\n            width = \"100%\", animate = TRUE\n          )\n        )\n      )\n    ),\n\n    card(\n      height = SSP_VH,\n      full_screen = TRUE,\n      card_header(\"Sample Size → Power\"),\n      card_body_fill(\n        plotOutput(\"demo_ssPowerPlotSSP\", height = \"100%\")\n      )\n    )\n  )\n}\n\n\nSSP_tab_power <- function() {\n  layout_columns(\n    col_widths = c(4, 8),\n\n    card(\n      height = SSP_VH,\n      card_header(\"Statistical Power\"),\n      card_body(\n        div(\n          style = paste0(\n            \"overflow-y:auto;\",\n            \"max-height:calc(100vh - 200px);\",\n            \"padding-right:8px;\"\n          ),\n\n          tagList(\n            p(strong(\"What it is\")),\n            p(\"Statistical power is the probability that a study will detect a real effect if it exists. For example, 80% power means the study would succeed about 8 times out of 10.\"),\n            p(\"Equivalently, power is how often you avoid a false negative (missing a real effect).\"),\n\n            p(strong(\"Why it matters\")),\n            p(\"Low-powered studies frequently miss real effects and produce unstable findings. Power reflects how capable a study is of answering its research question.\"),\n            p(\"Power depends on several linked choices: how big an effect you care about, how much data you can collect, how noisy the measurements are, and how strict you are about false alarms (the significance level).\"),\n\n            p(strong(\"What this visualization shows\")),\n            p(\"The curve shows how the required sample size changes as the effect size changes, assuming a chosen power target.\"),\n            p(\"Smaller effects require larger samples to reach the same power, because subtle signals are harder to distinguish from random variation.\"),\n\n            p(strong(\"Common pitfalls\")),\n            p(\"Non-significant results are often interpreted as evidence of no effect, even when a study simply lacks enough data to detect it.\"),\n            p(\"Post-hoc (after-the-fact) “power” calculations are commonly misused; they do not rescue an inconclusive study and often restate what the p-value already implies.\")\n          ),\n\n          hr(),\n\n          sliderInput(\n            \"demo_powerSSP\", \"Target power:\",\n            min = 0.5, max = 0.99, value = 0.8, step = 0.01,\n            width = \"100%\", animate = TRUE\n          )\n        )\n      )\n    ),\n\n    card(\n      height = SSP_VH,\n      full_screen = TRUE,\n      card_header(\"Effect Size → Required Sample Size\"),\n      card_body_fill(\n        plotOutput(\"demo_effSSPlotSSP\", height = \"100%\")\n      )\n    )\n  )\n}\n\n\nSSP_tab_tradeoffs <- function() {\n  layout_columns(\n    col_widths = c(4, 8),\n\n    card(\n      height = SSP_VH,\n      card_header(\"Assumptions & Constraints\"),\n      card_body(\n        div(\n          style = paste0(\n            \"overflow-y:auto;\",\n            \"max-height:calc(100vh - 200px);\",\n            \"padding-right:8px;\"\n          ),\n\n          tagList(\n            p(strong(\"Study design is a set of choices under constraints.\")),\n            p(\"Power analysis is often taught as a mathematical relationship, but in practice it functions more like budgeting: you are deciding what level of evidence you can afford given limits in time, money, staffing, recruitment, and ethical burden on participants.\"),\n\n            p(strong(\"The real constraint is usually resources.\")),\n            p(\"Funding and feasibility often dominate design decisions. Larger samples cost more to recruit, measure, and manage; longer follow-up increases attrition; tighter measurement protocols improve signal but increase burden; and multi-site or multi-group designs add complexity even when the math looks simple.\"),\n            p(\"A hidden lever is measurement quality: clearer, more reliable measurement reduces noise and can dramatically reduce the sample size needed for the same power.\"),\n\n            p(strong(\"What this visualization is meant to make visible.\")),\n            p(\"This tool shows how changing assumptions (effect size you care about, desired power, and significance level) forces changes in required sample size. The point is not to produce a single ‘correct’ number, but to reveal the trade-offs and to help you justify a design in plain language.\"),\n            p(\"Statistical significance is often mistaken for practical importance. Small effects can be statistically significant in large studies, while meaningful effects can go unnoticed in small studies.\"),\n            p(\"A useful way to interpret the trade-off is to ask: which mistake is more costly here—missing a real effect (false negative) or claiming an effect that is not real (false positive)? That choice should influence your power target and significance threshold.\")\n          ),\n\n          hr(),\n\n\n          # Your controls first (so people see knobs before prose)\n          uiOutput(\"var_selectorSSP\"),\n          uiOutput(\"groupsSSP\"),\n          uiOutput(\"df_chiSSP\"),\n        )\n      )\n    ),\n\n    card(\n      height = SSP_VH,\n      full_screen = TRUE,\n      card_header(\"Power Curve\"),\n      card_body_fill(\n        plotOutput(\"ss_power_plotSSP\", height = \"100%\")\n      )\n    )\n  )\n}\n\n\n\nclassify_test <- function(data, outcome_var, predictor_var, paired = FALSE) {\n  # Guard clauses: make sure the names exist\n  if (is.null(outcome_var) || is.null(predictor_var) ||\n      !outcome_var %in% names(data) || !predictor_var %in% names(data)) {\n    return(\"unsupported\")\n  }\n\n  x <- data[[outcome_var]]\n  y <- data[[predictor_var]]\n\n  ## 1) explicit paired design takes priority\n  if (paired && is.numeric(x) && is.numeric(y))\n    return(\"paired_t\")\n\n  ## 2) simple linear regression (both numeric, not paired)\n  if (is.numeric(x) && is.numeric(y))\n    return(\"slr\")\n\n  ## 3) two‑sample t (numeric outcome, binary predictor)\n  if (is.numeric(x) && is.factor(y) && nlevels(y) == 2)\n    return(\"two_t\")\n\n  ## 4) one‑way ANOVA (numeric outcome, >2‑level factor)\n  if (is.numeric(x) && is.factor(y) && nlevels(y) > 2)\n    return(\"anova1\")\n\n  ## 5) χ² test of independence (both factors)\n  if (is.factor(x) && is.factor(y))\n    return(\"chisq\")\n\n  ## fallback\n  \"unsupported\"\n}\n\n\n\nsolve_power <- function(test_type = c(\"paired_t\", \"two_t\", \"anova1\",\n                                      \"slr\", \"chisq\"),\n                        effect,          # Cohen dz / d / f / w  OR r2 for slr\n                        n      = NULL,   # supply *either* n *or* power\n                        power  = NULL,   # supply *either* power *or* n\n                        k      = NULL,   # # groups for anova1\n                        df_chi = NULL,   # df for chisq\n                        alpha = 0.05) {\n\n  test_type <- match.arg(test_type)\n\n  have_n     <- !is.null(n)\n  have_power <- !is.null(power)\n\n  if (have_n == have_power)\n    stop(\"Supply *exactly one* of 'n' or 'power'.\")\n\n  # ------------------------------------------------------------------------\n  # internal helper to make results uniform\n  fmt_res <- function(out_n, out_power, note = \"\") {\n    list(\n      test_type = test_type,\n      n         = unname(out_n),\n      power     = unname(out_power),\n      note      = note\n    )\n  }\n\n  # ========================================================================\n  # Paired‑samples t\n  # ========================================================================\n  if (test_type == \"paired_t\") {\n    if (have_n) {\n      pwr <- power.t.test(d = effect, n = n,\n                          sig.level = alpha,\n                          type = \"paired\")$power\n      return(fmt_res(out_n = n, out_power = pwr,\n                     note = \"n = # subject pairs\"))\n    } else {               # solve for n\n      out <- power.t.test(d = effect, power = power,\n                          sig.level = alpha,\n                          type = \"paired\")\n      return(fmt_res(out_n = ceiling(out$n), out_power = power,\n                     note = \"n = # subject pairs\"))\n    }\n  }\n\n  # ========================================================================\n  # Two‑sample t (equal group sizes)\n  # ========================================================================\n  if (test_type == \"two_t\") {\n    if (have_n) {\n      pwr <- power.t.test(d = effect, n = n,\n                          sig.level = alpha,\n                          type = \"two.sample\")$power\n      return(fmt_res(out_n = n, out_power = pwr,\n                     note = \"n = subjects per group\"))\n    } else {\n      out <- power.t.test(d = effect, power = power,\n                          sig.level = alpha,\n                          type = \"two.sample\")\n      return(fmt_res(out_n = ceiling(out$n), out_power = power,\n                     note = \"n = subjects per group\"))\n    }\n  }\n\n  # ========================================================================\n  # One‑way ANOVA (balanced)\n  # ========================================================================\n  if (test_type == \"anova1\") {\n    if (is.null(k) || k < 2)\n      stop(\"anova1: argument 'k' (# groups) must be >= 2\")\n\n    if (have_n) {\n      pwr <- pwr.anova.test(k = k, f = effect, n = n, sig.level = alpha)$power\n      return(fmt_res(out_n = n, out_power = pwr,\n                     note = \"n = subjects per group\"))\n    } else {\n      out <- pwr.anova.test(k = k, f = effect, power = power, sig.level = alpha)\n      return(fmt_res(out_n = ceiling(out$n), out_power = power,\n                     note = \"n = subjects per group\"))\n    }\n  }\n\n  # ========================================================================\n  # Simple linear regression (one predictor)\n  # effect is supplied as R² for transparency to users\n  # ========================================================================\n  if (test_type == \"slr\") {\n    if (effect <= 0 || effect >= 1)\n      stop(\"slr: 'effect' must be an anticipated R² in (0, 1).\")\n    f2 <- effect / (1 - effect)      # convert R² → f²\n    u  <- 1                          # predictors\n\n    if (have_n) {\n      v <- n - u - 1\n      if (v <= 0) stop(\"n too small for simple regression: need n > 2.\")\n      pwr <- pwr.f2.test(u = u, v = v, f2 = f2,\n                         sig.level = alpha)$power\n      return(fmt_res(out_n = n, out_power = pwr,\n                     note = \"n = total subjects\"))\n    } else {\n      out <- pwr.f2.test(u = u, f2 = f2, power = power,\n                         sig.level = alpha)\n      n_tot <- ceiling(out$v + u + 1)\n      return(fmt_res(out_n = n_tot, out_power = power,\n                     note = \"n = total subjects\"))\n    }\n  }\n\n  # ========================================================================\n  # Chi‑square test of independence / goodness‑of‑fit\n  # ========================================================================\n  if (test_type == \"chisq\") {\n    if (is.null(df_chi) || df_chi < 1)\n      stop(\"chisq: argument 'df_chi' (# degrees of freedom) must be >= 1\")\n\n    if (have_n) {\n      pwr <- pwr.chisq.test(w = effect, N = n, df = df_chi,\n                            sig.level = alpha)$power\n      return(fmt_res(out_n = n, out_power = pwr,\n                     note = \"n = total subjects\"))\n    } else {\n      out <- pwr.chisq.test(w = effect, power = power, df = df_chi,\n                            sig.level = alpha)\n      return(fmt_res(out_n = ceiling(out$N), out_power = power,\n                     note = \"n = total subjects\"))\n    }\n  }\n\n  stop(\"Unknown test_type.\")\n}\n","type":"text"},{"name":"SampleSizeApp.Rproj","content":"Version: 1.0\n\nRestoreWorkspace: Default\nSaveWorkspace: Default\nAlwaysSaveHistory: Default\n\nEnableCodeIndexing: Yes\nUseSpacesForTab: Yes\nNumSpacesForTab: 2\nEncoding: UTF-8\n\nRnwWeave: Sweave\nLaTeX: pdfLaTeX\n\nAutoAppendNewline: Yes\nStripTrailingWhitespace: Yes\n","type":"text"},{"name":"www/custom.css","content":"\n/* 1) Increase the app’s default font size */\nhtml {\n  font-size: 18px !important;  /* adjust this value to taste */\n}\n\n/* closed headers get light grey */\n.accordion-button.collapsed {\n  background-color: #f7f6f3 !important;\n}\n\n/* open headers get white */\n.accordion-button:not(.collapsed) {\n  background-color: #f7f6f3 !important;\n  color: #2f6f8f !important;\n  font-weight: bold !important;\n}\n\n\n.nav-link:hover {\n  color: #2f6f8f !important;\n  font-weight: bold;\n}\n\n\n/* 2) Top-level navbar: only active links get your brand color + bold */\n.navbar .navbar-brand,\n.navbar .nav-link {\n  color: inherit !important;\n  font-weight: normal !important;\n}\n.navbar .nav-link.active {\n  color: #2f6f8f !important;\n  font-weight: bold !important;\n}\n\n\n/* 3) Inner card-underline tabs (Tab A1, Tab B1, etc.): same rules */\n.navs-card-underline .nav-link .nav-link:hover {\n  color: inherit !important;\n  font-weight: normal !important;\n}\n.navs-card-underline .nav-link.active {\n  color: #2f6f8f !important;\n  font-weight: bold !important;\n  border-bottom-color: #2f6f8f !important;\n}\n\n/* border around each panel */\n.accordion .accordion-item {\n  border: 1px solid #ccc;\n  border-radius: 4px;\n  margin-bottom: 0.5rem; /* spacing between panels */\n}\n\n.accordion .accordion-item + .accordion-item {\n  margin-top: 0;\n}\n\n\n\n:root {\n  --font-sans: var(--bs-body-font-family);\n}\n","type":"text"}]
